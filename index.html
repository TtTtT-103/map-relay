<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Googleマップ連携</title>
    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; text-align: center; padding: 20px; background-color: #f8f9fa; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #333; margin-top: 0; font-size: 22px; }
        
        /* エリアごとのスタイル */
        .section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px dashed #ddd; }
        .section:last-child { border-bottom: none; }
        
        /* 1. メインボタン */
        .btn-primary { 
            display: block; width: 100%; padding: 18px; 
            background-color: #4285F4; color: white; 
            text-decoration: none; border-radius: 8px; 
            font-weight: bold; font-size: 18px; 
            box-shadow: 0 4px 6px rgba(66, 133, 244, 0.3);
            transition: all 0.2s;
        }
        .btn-primary:hover { background-color: #3367d6; transform: translateY(-1px); }

        /* 2. コピーエリア */
        .input-group { display: flex; gap: 10px; margin-top: 10px; }
        input[type="text"] {
            flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; background: #f1f1f1; color: #555;
        }
        .btn-copy {
            padding: 0 20px; background-color: #333; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;
        }
        .btn-copy:active { background-color: #000; }
        
        /* 3. QRコード */
        .qr-img { margin-top: 10px; border: 1px solid #eee; padding: 5px; }

        .label { font-size: 14px; font-weight: bold; color: #555; display: block; margin-bottom: 8px; text-align: left; }
        .note { font-size: 12px; color: #d93025; text-align: left; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>経路情報の準備完了</h2>

        <div class="section">
            <span class="label">方法1: ボタンを押して開く</span>
            <a id="link-btn" href="#" class="btn-primary" target="_blank" rel="noopener noreferrer">Googleマップを開く</a>
            <p class="note">※エラーが出る場合は、下の「方法2」を試してください。</p>
        </div>

        <div class="section">
            <span class="label">方法2: URLをコピーして新しいタブで開く</span>
            <div class="input-group">
                <input type="text" id="url-input" readonly onclick="this.select();">
                <button class="btn-copy" onclick="copyUrl()">コピー</button>
            </div>
            <p id="copy-msg" style="font-size:12px; color:green; height:1.2em; text-align:right; margin:4px 0 0 0;"></p>
        </div>

        <div class="section">
            <span class="label">方法3: スマホで読み取る</span>
            <img id="qr-img" class="qr-img" src="" alt="QRコード生成中..." width="150" height="150">
        </div>
    </div>

    <script>
        // パラメータ取得
        const params = new URLSearchParams(window.location.search);
        const origin = params.get('o');
        const dest = params.get('d');
        const mode = params.get('m') || 'driving';

        // 要素取得
        const linkBtn = document.getElementById('link-btn');
        const urlInput = document.getElementById('url-input');
        const qrImg = document.getElementById('qr-img');

        if (origin && dest) {
            // Google Maps URL生成
            const mapsUrl = `https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${dest}&travelmode=${mode}`;

            // 1. ボタンに設定
            linkBtn.href = mapsUrl;

            // 2. 入力欄に設定
            urlInput.value = mapsUrl;

            // 3. QRコード生成 (Google Chart API使用)
            qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(mapsUrl)}`;
        } else {
            document.querySelector('.container').innerHTML = '<p style="color:red">エラー: 経路データが見つかりません。<br>Re:Earthからやり直してください。</p>';
        }

        // コピー機能
        function copyUrl() {
            const copyText = document.getElementById("url-input");
            copyText.select();
            copyText.setSelectionRange(0, 99999); // モバイル対応
            
            try {
                navigator.clipboard.writeText(copyText.value).then(() => {
                    document.getElementById("copy-msg").innerText = "コピーしました！新しいタブに貼り付けてください。";
                });
            } catch (err) {
                // 古いブラウザ用フォールバック
                document.execCommand('copy');
                document.getElementById("copy-msg").innerText = "コピーしました！";
            }
        }
    </script>
</body>
</html>
